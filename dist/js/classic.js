let socket,typingTimeout,currentUser=null,currentRoom="general",isTyping=!1,selectedAvatar="default",selectedPower=null,soundEnabled=!0,musicEnabled=!0,effectsEnabled=!0,userPowers=[],allPowers=[],commandHistory=[],commandIndex=-1;const POWER_TYPES={CHAT:"chat",AVATAR:"avatar",ROOM:"room",USER:"user",EFFECT:"effect"},POWER_RARITY={COMMON:"common",UNCOMMON:"uncommon",RARE:"rare",EPIC:"epic",LEGENDARY:"legendary"},COMMANDS={"/help":{description:"Show available commands",handler:showHelp},"/me":{description:"Perform an action",handler:handleMeCommand},"/p":{description:"Send private message",handler:handlePrivateMessage},"/clear":{description:"Clear chat",handler:clearChat},"/away":{description:"Set away status",handler:setAwayStatus},"/back":{description:"Set back status",handler:setBackStatus},"/kick":{description:"Kick user (mod only)",handler:kickUser},"/ban":{description:"Ban user (mod only)",handler:banUser},"/mute":{description:"Mute user (mod only)",handler:muteUser},"/unmute":{description:"Unmute user (mod only)",handler:unmuteUser},"/topic":{description:"Set room topic (owner only)",handler:setTopic},"/bg":{description:"Set background",handler:setBackground},"/music":{description:"Play music",handler:playMusic},"/stopmusic":{description:"Stop music",handler:stopMusic},"/smiley":{description:"Show smiley list",handler:showSmileyList},"/power":{description:"Activate power",handler:activatePower},"/avatar":{description:"Change avatar",handler:changeAvatar},"/rainbow":{description:"Rainbow text effect",handler:rainbowText},"/sparkle":{description:"Sparkle effect",handler:sparkleEffect},"/fire":{description:"Fire effect",handler:fireEffect},"/ice":{description:"Ice effect",handler:iceEffect},"/lightning":{description:"Lightning effect",handler:lightningEffect},"/star":{description:"Star effect",handler:starEffect},"/diamond":{description:"Diamond effect",handler:diamondEffect},"/musicnote":{description:"Music note effect",handler:musicNoteEffect},"/drama":{description:"Drama effect",handler:dramaEffect}},AVATAR_PARTS={head:["head1","head2","head3","head4","head5","head6","head7","head8","head9","head10"],eyes:["eyes1","eyes2","eyes4","eyes5","eyes6","eyes7","eyes8","eyes9","eyes10","eyes11","eyes12","eyes13","eyes14"],mouth:["mouthdefault"],hair:["hair0","hair1","hair2","hair3","hair4","hair5","hair6","hair7","hair8","hair9","hair10","hair11","hair12"],hat:["hat1","hat2","hat3","hat4","hat5","hat6","hat7","hat8","hat9","hat10","hat11","hat12","hat13","hat14","hat15","hat16","hat17","hat18","hat19","hat20","hat21","hat22","hat23","hat24","hat25","hat26","hat27","hat28","hat29","hat30","hat31","hat32","hat33","hat34","hat35","hat36","hat37","hat38","hat39","hat40"],brows:["browdefault"]},SMILEYS={":D":{emoji:"üòÄ",action:"biggrin"},":)":{emoji:"üôÇ",action:"smile"},":(":{emoji:"üò¢",action:"crying"},";)":{emoji:"üòâ",action:"wink"},":P":{emoji:"üòõ",action:"tongue"},":O":{emoji:"üòÆ",action:"eek"},"<3":{emoji:"‚ù§Ô∏è",action:"heart"},lol:{emoji:"üòÇ",action:"laugh"},cool:{emoji:"üòé",action:"cool"},mad:{emoji:"üò†",action:"mad"},sleepy:{emoji:"üò¥",action:"sleepy"},confused:{emoji:"üòï",action:"confused"},what:{emoji:"ü§î",action:"what"},yes:{emoji:"üëç",action:"yes"},no:{emoji:"üëé",action:"no"}},messageInput=document.getElementById("message-input"),sendButton=document.getElementById("send-button"),messageList=document.getElementById("message-list"),userList=document.getElementById("user-list"),roomSelect=document.getElementById("room-select"),backgroundSelect=document.getElementById("background-select"),avatarContainer=document.getElementById("avatar-container"),powerBar=document.getElementById("power-bar"),smileyBar=document.getElementById("smiley-bar"),typingIndicator=document.getElementById("typing-indicator"),connectionStatus=document.getElementById("connection-status"),userInfo=document.getElementById("user-info"),musicPlayer=document.getElementById("music-player"),powerAnimations=document.getElementById("classic-power-animations");function initializeEnhancedChat(){setTimeout(()=>{connectionStatus.textContent="üü¢ Connected",connectionStatus.className="status connected",currentUser={id:"user_"+Math.random().toString(36).substr(2,9),username:"User"+Math.floor(1e3*Math.random()),avatar:selectedAvatar,level:Math.floor(50*Math.random())+1,xats:Math.floor(1e4*Math.random())+1e3,powers:[],isMod:Math.random()>.8,isOwner:Math.random()>.95,status:"online"},userInfo.innerHTML=`\n            <span class="username">üë§ ${currentUser.username} (Level ${currentUser.level})</span>\n            <span class="xats">üí∞ ${currentUser.xats} xats</span>\n        `,joinRoom("general")},1e3)}function loadPowers(){allPowers=[{id:1,name:"rainbow",description:"Rainbow text effect",cost:100,type:POWER_TYPES.CHAT,rarity:POWER_RARITY.RARE,effect:"rainbow"},{id:2,name:"sparkle",description:"Sparkle effect",cost:50,type:POWER_TYPES.AVATAR,rarity:POWER_RARITY.COMMON,effect:"sparkle"},{id:3,name:"fire",description:"Fire effect",cost:200,type:POWER_TYPES.EFFECT,rarity:POWER_RARITY.UNCOMMON,effect:"fire"},{id:4,name:"ice",description:"Ice effect",cost:150,type:POWER_TYPES.EFFECT,rarity:POWER_RARITY.UNCOMMON,effect:"ice"},{id:5,name:"lightning",description:"Lightning effect",cost:300,type:POWER_TYPES.EFFECT,rarity:POWER_RARITY.RARE,effect:"lightning"},{id:6,name:"star",description:"Star effect",cost:75,type:POWER_TYPES.AVATAR,rarity:POWER_RARITY.COMMON,effect:"star"},{id:7,name:"diamond",description:"Diamond effect",cost:500,type:POWER_TYPES.EFFECT,rarity:POWER_RARITY.EPIC,effect:"diamond"},{id:8,name:"musicnote",description:"Music note effect",cost:120,type:POWER_TYPES.EFFECT,rarity:POWER_RARITY.COMMON,effect:"musicnote"},{id:9,name:"drama",description:"Drama effect",cost:80,type:POWER_TYPES.EFFECT,rarity:POWER_RARITY.COMMON,effect:"drama"}],updatePowerBar()}function loadAvatars(){avatarContainer.innerHTML=["default","1759","998","999","994","995","996","997","992","993","989","99","990","991","987","988","983","984","985","986"].map(e=>`<div class="avatar-item" data-avatar="${e}">\n            <img src="/avatars/${e}.png" alt="${e}" onerror="this.style.display='none'">\n        </div>`).join("")}function updatePowerBar(){powerBar.innerHTML=allPowers.map(e=>`<div class="power-item" data-power="${e.name}" title="${e.description} (${e.cost} xats)">\n            <span class="power-icon">${getPowerIcon(e.name)}</span>\n            <span class="power-name">${e.name}</span>\n        </div>`).join("")}function getPowerIcon(e){return{rainbow:"üåà",sparkle:"‚≠ê",fire:"üî•",ice:"‚ùÑÔ∏è",lightning:"‚ö°",star:"‚≠ê",diamond:"üíé",musicnote:"üéµ",drama:"üé≠"}[e]||"‚ú®"}function setupCommandSystem(){messageInput.addEventListener("keydown",e=>{"ArrowUp"===e.key?(e.preventDefault(),navigateCommandHistory("up")):"ArrowDown"===e.key&&(e.preventDefault(),navigateCommandHistory("down"))})}function navigateCommandHistory(e){"up"===e&&commandIndex<commandHistory.length-1?(commandIndex++,messageInput.value=commandHistory[commandHistory.length-1-commandIndex]):"down"===e&&commandIndex>0?(commandIndex--,messageInput.value=commandHistory[commandHistory.length-1-commandIndex]):"down"===e&&0===commandIndex&&(commandIndex=-1,messageInput.value="")}function setupEventListeners(){sendButton.addEventListener("click",sendMessage),messageInput.addEventListener("keypress",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),sendMessage())}),messageInput.addEventListener("input",()=>{isTyping||(isTyping=!0,showTypingIndicator()),clearTimeout(typingTimeout),typingTimeout=setTimeout(()=>{isTyping=!1,hideTypingIndicator()},2e3)}),roomSelect.addEventListener("change",e=>{joinRoom(e.target.value)}),backgroundSelect.addEventListener("change",e=>{changeBackground(e.target.value)}),avatarContainer.addEventListener("click",e=>{if(e.target.closest(".avatar-item")){const t=e.target.closest(".avatar-item");selectedAvatar=t.dataset.avatar,updateUserAvatar(),addPowerEffect("avatar-change")}}),powerBar.addEventListener("click",e=>{e.target.closest(".power-item")&&activatePowerByName(e.target.closest(".power-item").dataset.power)}),smileyBar.addEventListener("click",e=>{e.target.classList.contains("smiley-item")&&insertSmiley(e.target.textContent)}),musicPlayer&&musicPlayer.addEventListener("play",()=>{musicEnabled&&addPowerEffect("music-start")})}function sendMessage(){const e=messageInput.value.trim();if(e)return commandHistory.push(e),commandHistory.length>50&&commandHistory.shift(),commandIndex=-1,e.startsWith("/")?(handleCommand(e),void(messageInput.value="")):(addMessage({id:"msg_"+Date.now(),user:currentUser,content:e,timestamp:new Date,avatar:selectedAvatar,power:selectedPower}),messageInput.value="",hideTypingIndicator(),selectedPower&&(addPowerEffect("message-send"),selectedPower=null),void(soundEnabled&&playSound("message")))}function handleCommand(e){const t=e.split(" "),a=t[0].toLowerCase(),n=t.slice(1);COMMANDS[a]?COMMANDS[a].handler(n):addSystemMessage(`Unknown command: ${a}. Type /help for available commands.`)}function showHelp(){addSystemMessage("Available commands:\n"+Object.entries(COMMANDS).map(([e,t])=>`${e} - ${t.description}`).join("\n"))}function handleMeCommand(e){if(0===e.length)return void addSystemMessage("Usage: /me <action>");const t=e.join(" ");addMessage({id:"msg_"+Date.now(),user:currentUser,content:`*${currentUser.username} ${t}*`,timestamp:new Date,avatar:selectedAvatar,isAction:!0})}function handlePrivateMessage(e){e.length<2?addSystemMessage("Usage: /p <username> <message>"):addSystemMessage(`[PM to ${e[0]}]: ${e.slice(1).join(" ")}`)}function clearChat(){messageList.innerHTML='\n        <div class="welcome-message">\n            <h2>üåü Chat Cleared! üåü</h2>\n            <p>Chat history has been cleared.</p>\n        </div>\n    '}function setAwayStatus(){currentUser.status="away",addSystemMessage(`${currentUser.username} is now away.`)}function setBackStatus(){currentUser.status="online",addSystemMessage(`${currentUser.username} is back.`)}function kickUser(e){currentUser.isMod?0!==e.length?addSystemMessage(`${e[0]} has been kicked from the room.`):addSystemMessage("Usage: /kick <username>"):addSystemMessage("You do not have permission to kick users.")}function banUser(e){currentUser.isMod?0!==e.length?addSystemMessage(`${e[0]} has been banned from the room.`):addSystemMessage("Usage: /ban <username>"):addSystemMessage("You do not have permission to ban users.")}function muteUser(e){currentUser.isMod?0!==e.length?addSystemMessage(`${e[0]} has been muted.`):addSystemMessage("Usage: /mute <username>"):addSystemMessage("You do not have permission to mute users.")}function unmuteUser(e){currentUser.isMod?0!==e.length?addSystemMessage(`${e[0]} has been unmuted.`):addSystemMessage("Usage: /unmute <username>"):addSystemMessage("You do not have permission to unmute users.")}function setTopic(e){currentUser.isOwner?0!==e.length?addSystemMessage(`Room topic changed to: ${e.join(" ")}`):addSystemMessage("Usage: /topic <new topic>"):addSystemMessage("You do not have permission to set the topic.")}function setBackground(e){if(0===e.length)return void addSystemMessage("Usage: /bg <background>");const t=e[0];changeBackground(t),addSystemMessage(`Background changed to: ${t}`)}function playMusic(e){0!==e.length?(addSystemMessage(`Now playing: ${e.join(" ")}`),musicPlayer&&musicPlayer.play()):addSystemMessage("Usage: /music <song>")}function stopMusic(){addSystemMessage("Music stopped."),musicPlayer&&(musicPlayer.pause(),musicPlayer.currentTime=0)}function showSmileyList(){addSystemMessage("Available smilies: "+Object.entries(SMILEYS).map(([e,t])=>`${e} ${t.emoji}`).join(" "))}function activatePower(e){0!==e.length?activatePowerByName(e[0]):addSystemMessage("Usage: /power <powername>")}function changeAvatar(e){if(0===e.length)return void addSystemMessage("Usage: /avatar <avatarname>");const t=e[0];selectedAvatar=t,updateUserAvatar(),addSystemMessage(`Avatar changed to: ${t}`)}function rainbowText(e){if(0===e.length)return void addSystemMessage("Usage: /rainbow <text>");const t=e.join(" ");addMessage({id:"msg_"+Date.now(),user:currentUser,content:t,timestamp:new Date,avatar:selectedAvatar,power:"rainbow"})}function sparkleEffect(e){addPowerEffect("sparkle"),addSystemMessage("Sparkle effect activated!")}function fireEffect(e){addPowerEffect("fire"),addSystemMessage("Fire effect activated!")}function iceEffect(e){addPowerEffect("ice"),addSystemMessage("Ice effect activated!")}function lightningEffect(e){addPowerEffect("lightning"),addSystemMessage("Lightning effect activated!")}function starEffect(e){addPowerEffect("star"),addSystemMessage("Star effect activated!")}function diamondEffect(e){addPowerEffect("diamond"),addSystemMessage("Diamond effect activated!")}function musicNoteEffect(e){addPowerEffect("musicnote"),addSystemMessage("Music note effect activated!")}function dramaEffect(e){addPowerEffect("drama"),addSystemMessage("Drama effect activated!")}function activatePowerByName(e){const t=allPowers.find(t=>t.name===e);t?currentUser.xats<t.cost?addSystemMessage(`You need ${t.cost} xats to use ${t.name}.`):(selectedPower=t,currentUser.xats-=t.cost,updateUserInfo(),addPowerEffect("power-activate"),addSystemMessage(`${t.name} power activated! (Cost: ${t.cost} xats)`)):addSystemMessage(`Power '${e}' not found.`)}function updateUserInfo(){userInfo.innerHTML=`\n        <span class="username">\n            <img src="/avatars/${currentUser.avatar}.png" class="user-avatar-small" onerror="this.style.display='none'">\n            ${currentUser.username} (Level ${currentUser.level})\n        </span>\n        <span class="xats">üí∞ ${currentUser.xats} xats</span>\n    `}function addMessage(e){const t=document.createElement("div");t.className="message-item";let a=formatMessage(e.content);e.power&&(a=applyPowerEffect(a,e.power),t.classList.add("power-message")),e.isAction?(t.classList.add("action-message"),t.innerHTML=`\n            <div class="message-content action-content">\n                ${a}\n            </div>\n        `):t.innerHTML=`\n            <div class="message-header">\n                <span class="message-username">\n                    <img src="/avatars/${e.avatar}.png" class="message-avatar" onerror="this.style.display='none'">\n                    ${e.user.username}\n                </span>\n                <span class="message-time">${formatTime(e.timestamp)}</span>\n            </div>\n            <div class="message-content">${a}</div>\n        `,messageList.appendChild(t),scrollToBottom(),e.power&&(t.style.animation="rainbow 2s infinite")}function applyPowerEffect(e,t){switch(t){case"rainbow":return`<span class="rainbow-text">${e}</span>`;case"sparkle":return`<span class="sparkle-text">${e} ‚ú®</span>`;case"fire":return`<span class="fire-text">${e} üî•</span>`;case"ice":return`<span class="ice-text">${e} ‚ùÑÔ∏è</span>`;case"lightning":return`<span class="lightning-text">${e} ‚ö°</span>`;case"star":return`<span class="star-text">${e} ‚≠ê</span>`;case"diamond":return`<span class="diamond-text">${e} üíé</span>`;case"musicnote":return`<span class="musicnote-text">${e} üéµ</span>`;case"drama":return`<span class="drama-text">${e} üé≠</span>`;default:return e}}function formatMessage(e){let t=e;return Object.entries(SMILEYS).forEach(([e,a])=>{t=t.replace(new RegExp(e,"gi"),a.emoji)}),t}function insertSmiley(e){const t=messageInput.selectionStart,a=messageInput.value.substring(0,t),n=messageInput.value.substring(t);messageInput.value=a+e+n,messageInput.focus(),messageInput.setSelectionRange(t+e.length,t+e.length)}function joinRoom(e){e&&(currentRoom=e,document.getElementById("room-info").innerHTML=`\n        <h4>üéÆ ${e.charAt(0).toUpperCase()+e.slice(1)}</h4>\n        <span class="user-count">üë• ${Math.floor(50*Math.random())+5} users</span>\n    `,messageList.innerHTML=`\n        <div class="welcome-message">\n            <h2>üåü Welcome to ${e.charAt(0).toUpperCase()+e.slice(1)}! üåü</h2>\n            <p>You've joined the ${e} room</p>\n            <div class="classic-features">\n                <span>üé≠ Avatars</span>\n                <span>‚ú® Powers</span>\n                <span>üòä Smilies</span>\n                <span>üéµ Music</span>\n                <span>‚ö° Commands</span>\n            </div>\n        </div>\n    `,updateUserList(),addPowerEffect("room-join"),addSystemMessage(`You joined ${e}. Type /help for commands.`))}function updateUserList(){userList.innerHTML=[{name:"ChatMaster",avatar:"1759",level:99,isMod:!0},{name:"CoolUser",avatar:"998",level:45},{name:"Gamer123",avatar:"999",level:32},{name:"MusicLover",avatar:"994",level:28},{name:"AnimeFan",avatar:"995",level:15}].map(e=>`\n        <div class="user-item">\n            <img src="/avatars/${e.avatar}.png" class="user-avatar" onerror="this.style.display='none'">\n            <span class="user-name">${e.name}</span>\n            <span class="user-level">(Level ${e.level})</span>\n            ${e.isMod?'<span class="user-mod">üëë</span>':""}\n        </div>\n    `).join("")}function changeBackground(e){const t=document.body;switch(e){case"space":t.style.background="linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%)";break;case"nature":t.style.background="linear-gradient(135deg, #2d5016 0%, #4a7c59 50%, #7fb069 100%)";break;case"abstract":t.style.background="linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 50%, #45b7d1 100%)";break;case"neon":t.style.background="linear-gradient(135deg, #ff006e 0%, #8338ec 50%, #3a86ff 100%)";break;default:t.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}function updateUserAvatar(){currentUser&&(currentUser.avatar=selectedAvatar,userInfo.innerHTML=`\n            <span class="username">\n                <img src="/avatars/${selectedAvatar}.png" class="user-avatar-small" onerror="this.style.display='none'">\n                ${currentUser.username} (Level ${currentUser.level})\n            </span>\n            <span class="xats">üí∞ ${currentUser.xats} xats</span>\n        `)}function addPowerEffect(e){if(!effectsEnabled)return;const t=document.createElement("div");switch(t.className="power-effect",e){case"power-activate":t.innerHTML=getPowerIcon(selectedPower?.name||"sparkle"),t.style.fontSize="48px",t.style.left=80*Math.random()+10+"%",t.style.top=80*Math.random()+10+"%";break;case"message-send":t.innerHTML="‚ú®",t.style.fontSize="32px",t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%, -50%)";break;case"room-join":t.innerHTML="üöÄ",t.style.fontSize="40px",t.style.left="50%",t.style.top="20%",t.style.transform="translateX(-50%)";break;case"avatar-change":t.innerHTML="üîÑ",t.style.fontSize="36px",t.style.left="80%",t.style.top="10%";break;case"music-start":t.innerHTML="üéµ",t.style.fontSize="44px",t.style.left="20%",t.style.top="80%";break;case"sparkle":t.innerHTML="‚ú®",t.style.fontSize="32px",t.style.left=80*Math.random()+10+"%",t.style.top=80*Math.random()+10+"%";break;case"fire":t.innerHTML="üî•",t.style.fontSize="40px",t.style.left=80*Math.random()+10+"%",t.style.top=80*Math.random()+10+"%";break;case"ice":t.innerHTML="‚ùÑÔ∏è",t.style.fontSize="40px",t.style.left=80*Math.random()+10+"%",t.style.top=80*Math.random()+10+"%";break;case"lightning":t.innerHTML="‚ö°",t.style.fontSize="44px",t.style.left=80*Math.random()+10+"%",t.style.top=80*Math.random()+10+"%";break;case"star":t.innerHTML="‚≠ê",t.style.fontSize="36px",t.style.left=80*Math.random()+10+"%",t.style.top=80*Math.random()+10+"%";break;case"diamond":t.innerHTML="üíé",t.style.fontSize="48px",t.style.left=80*Math.random()+10+"%",t.style.top=80*Math.random()+10+"%";break;case"musicnote":t.innerHTML="üéµ",t.style.fontSize="40px",t.style.left=80*Math.random()+10+"%",t.style.top=80*Math.random()+10+"%";break;case"drama":t.innerHTML="üé≠",t.style.fontSize="40px",t.style.left=80*Math.random()+10+"%",t.style.top=80*Math.random()+10+"%"}powerAnimations.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)}function addSystemMessage(e){const t=document.createElement("div");t.className="message-item system-message",t.innerHTML=`\n        <div class="message-content" style="text-align: center; font-style: italic; color: #7f8c8d;">\n            ${e}\n        </div>\n    `,messageList.appendChild(t),scrollToBottom()}function showTypingIndicator(){typingIndicator.style.display="flex",scrollToBottom()}function hideTypingIndicator(){typingIndicator.style.display="none"}function scrollToBottom(){const e=document.querySelector(".classic-messages-area");e.scrollTop=e.scrollHeight}function formatTime(e){return e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function playSound(e){const t=new(window.AudioContext||window.webkitAudioContext),a=t.createOscillator(),n=t.createGain();switch(a.connect(n),n.connect(t.destination),e){case"message":a.frequency.setValueAtTime(800,t.currentTime),a.frequency.exponentialRampToValueAtTime(400,t.currentTime+.1);break;case"power":a.frequency.setValueAtTime(1200,t.currentTime),a.frequency.exponentialRampToValueAtTime(200,t.currentTime+.2)}n.gain.setValueAtTime(.1,t.currentTime),n.gain.exponentialRampToValueAtTime(.01,t.currentTime+.1),a.start(t.currentTime),a.stop(t.currentTime+.1)}function loadUserPreferences(){const e=localStorage.getItem("xat-sound-enabled"),t=localStorage.getItem("xat-music-enabled"),a=localStorage.getItem("xat-effects-enabled");null!==e&&(soundEnabled="true"===e),null!==t&&(musicEnabled="true"===t),null!==a&&(effectsEnabled="true"===a)}function createSampleMessages(){const e=[{user:"ChatMaster",content:"Welcome to the enhanced xat experience! üåü",avatar:"1759",isMod:!0},{user:"CoolUser",content:"This brings back memories! :D",avatar:"998"},{user:"Gamer123",content:"Anyone up for some retro gaming? üéÆ",avatar:"999"},{user:"MusicLover",content:"The music player is working great! üéµ",avatar:"994"},{user:"AnimeFan",content:"Love the retro vibes here! <3",avatar:"995"}];setTimeout(()=>{e.forEach((e,t)=>{setTimeout(()=>{addMessage({id:"sample_"+t,user:{username:e.user,avatar:e.avatar,isMod:e.isMod},content:e.content,timestamp:new Date})},2e3*t)})},2e3)}document.addEventListener("DOMContentLoaded",()=>{initializeEnhancedChat(),setupEventListeners(),loadUserPreferences(),loadPowers(),loadAvatars(),createSampleMessages(),setupCommandSystem()});const style=document.createElement("style");style.textContent="\n  @keyframes rainbow {\n    0% { color: #ff0000; }\n    14% { color: #ff7f00; }\n    28% { color: #ffff00; }\n    42% { color: #00ff00; }\n    57% { color: #0000ff; }\n    71% { color: #4b0082; }\n    85% { color: #9400d3; }\n    100% { color: #ff0000; }\n  }\n\n  .power-message {\n    background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);\n    background-size: 400% 400%;\n    animation: gradientShift 2s ease infinite;\n  }\n\n  @keyframes gradientShift {\n    0% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n    100% { background-position: 0% 50%; }\n  }\n\n  .system-message {\n    background: rgba(52, 152, 219, 0.1);\n    border-left-color: #3498db;\n  }\n\n  .action-message {\n    background: rgba(155, 89, 182, 0.1);\n    border-left-color: #9b59b6;\n  }\n\n  .action-content {\n    font-style: italic;\n    color: #9b59b6;\n  }\n\n  .rainbow-text {\n    animation: rainbow 2s infinite;\n  }\n\n  .sparkle-text {\n    text-shadow: 0 0 10px #ffd700;\n  }\n\n  .fire-text {\n    color: #ff4500;\n    text-shadow: 0 0 10px #ff4500;\n  }\n\n  .ice-text {\n    color: #00bfff;\n    text-shadow: 0 0 10px #00bfff;\n  }\n\n  .lightning-text {\n    color: #ffff00;\n    text-shadow: 0 0 15px #ffff00;\n  }\n\n  .star-text {\n    color: #ffd700;\n    text-shadow: 0 0 10px #ffd700;\n  }\n\n  .diamond-text {\n    color: #b9f2ff;\n    text-shadow: 0 0 15px #b9f2ff;\n  }\n\n  .musicnote-text {\n    color: #ff69b4;\n    text-shadow: 0 0 10px #ff69b4;\n  }\n\n  .drama-text {\n    color: #ff1493;\n    text-shadow: 0 0 10px #ff1493;\n  }\n\n  .message-avatar {\n    width: 24px;\n    height: 24px;\n    border-radius: 50%;\n    margin-right: 8px;\n    vertical-align: middle;\n  }\n\n  .user-avatar {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    margin-right: 5px;\n    vertical-align: middle;\n  }\n\n  .user-avatar-small {\n    width: 16px;\n    height: 16px;\n    border-radius: 50%;\n    margin-right: 5px;\n    vertical-align: middle;\n  }\n\n  .user-mod {\n    color: #f39c12;\n    font-weight: bold;\n  }\n\n  .power-item {\n    cursor: pointer;\n    padding: 5px;\n    border-radius: 5px;\n    transition: background-color 0.2s;\n  }\n\n  .power-item:hover {\n    background-color: rgba(255, 255, 255, 0.2);\n  }\n\n  .power-icon {\n    font-size: 20px;\n    margin-right: 5px;\n  }\n\n  .power-name {\n    font-size: 12px;\n  }\n\n  .avatar-item {\n    cursor: pointer;\n    padding: 5px;\n    border-radius: 5px;\n    transition: background-color 0.2s;\n    text-align: center;\n  }\n\n  .avatar-item:hover {\n    background-color: rgba(255, 255, 255, 0.2);\n  }\n\n  .avatar-item img {\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n  }\n",document.head.appendChild(style),console.log("üåü Enhanced Classic Xat Chat initialized with full power system! üåü");